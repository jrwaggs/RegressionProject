---
title: "Regression Project"
author: "JR Waggoner, Jose Baldomar, Andre Louie"
date: "April 10, 2019"
output: html_document
---

```{r setup, include=FALSE}

knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(warning = FALSE)
library(dplyr)
library(ggplot2)
library(GGally)
```

``` {r importing the data,echo = FALSE}
# import the CSV
loandata <- read.csv("LoanStats3a.csv")
loan <- loandata
```

```{r convert revolving utilization to numeric,echo = FALSE}
#convert revolving util from string % to numeric decimal
loan$revol_util<- as.numeric(sub("%","",loan$revol_util))/100
```

```{r target variable,echo = FALSE}
#compute target dependent variable, total paid
loan <- loan %>%
  mutate(tot_paid = total_rec_prncp + total_rec_int)
```

```{r drop all nas, echo = false}
#drop NAs
loan <-loan[complete.cases(loandata),]  
```

```{r factor term, echo = FALSE}
#factor loan_term; 2 levels (3,5 years)
loan$term <- factor(loan$term)
```

```{r factor purpose, echo = FALSE}
# there are 15 purpose categories, -> factor 
loan$purpose <- factor(loan$purpose)
```

### **Abstract**
Abstract text

### **Introduction**
Introduction text
the context, what we set out to research or discover.  what is the application or intended use

model could be used to churn through existing loan portfolio and estimate what value is remaining.

how would introducing a different length lona term affect overall payout?

### **Overview of the DataSet**
  The raw dataset is comprised of information describing all loans issued by LendingClub between 2007 and 2011. The data set can be found at  https://www.lendingclub.com/foliofn/rateDetail.action . From the raw data, a test set was created by first removing all columns that were entirely composed of missing values or contained the same value for each record.  Additionally, columns containing free text - title, description, etc., were removed along with redundant features that were a subset or component of another feature (sub-grade, funded amount,etc)  Finally, a target variable of 'total paid' was created by combining total principal and total interest, excluding any collection amounts or fees received.  Features relating to total amounts collected or recovered were also excluded from the test data set.

```{r exclude 1 record, echo = FALSE}
# randomly pull one record from the dataframe

#copy row @ index 2000 to new DF
test_case <- loan[2000,]
#delete row @ 2000 from original DF
loan <- loan[-c(2000),]
```
  
### **Exploratory analysis**
Exploratory text

##### **Distributions**

```{r  paid dist, echo=FALSE}
# distribution of Total paid
ggplot(loan, aes(tot_paid))+
  geom_histogram(bins = 30)+
  ggtitle("Distribution of Total Paid")+
  xlab("Total Paid")
```

```{r loan amt dist,echo=FALSE}
#distribution of loan amounts
ggplot(loan,aes(loan_amnt))+
  geom_histogram(bins = 7)+
  ggtitle("Distribution of Loan Amounts")+
  xlab("Loan amount")
```

```{r int rate dist,echo=FALSE}
# distribution of interest rates
ggplot(loan,aes(int_rate))+
  geom_histogram(bins=20)+
  ggtitle("Distribution of Loan Interest Rates")+
  xlab("Interest Rate")
```

```{r income dist,echo=FALSE}
#distribution of of annual incomes
ggplot(loan,aes(annual_inc))+
  geom_histogram(bins = 20)+
  ggtitle(("Distribution of Borrower Annual Income"))+
  xlab("Annual Income")+
  xlim(0,200000)
```

```{r loan purpose, echo = FALSE}
# Count of loan purpose
ggplot(loan,aes(purpose))+
  geom_bar()+
  ggtitle("Count of Loans by purpose")+
  xlab("Purpose")+
  coord_flip()
```

##### **Categorical Variables**

```{r repaid by purpose, echo = FALSE}
# boxplot of total repaid by purpose, with coordinates flipped
ggplot(loan, aes(purpose, tot_paid))+
  geom_boxplot()+
  coord_flip()+
  ggtitle("Total Paid by Purpose")+
  xlab("Purpose")+
  ylab("Total Paid")
```

```{r repaid by term, echo = FALSE}
# boxplot of loanterm  vs. total paid
ggplot(loan,aes(term,tot_paid)) +
  geom_boxplot()+
  ggtitle("Total Paid by Loan Term")+
  xlab("Loan Term")+
  ylab("Total Paid")

```

```{r loan amount by purpose, echo = FALSE}
# boxplot of loan amount by purpose
ggplot(loan,aes(purpose,loan_amnt))+
  geom_boxplot()+
  coord_flip()+
  ggtitle("Loan Amount by Purpose")+
  xlab("Purpose")+
  ylab("Loan Amount")
```

##### **Correlation Analysis**
```{r pairwise plot, echo = FALSE}
#subset of only numeric vaiables
numeric_loan <- loan %>%
   select(loan_amnt,int_rate,inq_last_6mths,annual_inc,installment,delinq_2yrs,tot_paid  )

#pairwise plots of numeric values  
ggpairs(numeric_loan)
```

### **Model Identification and Evaluation** 
Model Identification text
```{r the model, echo = FALSE}
testmodel3 <- lm(tot_paid~loan_amnt+term+int_rate+installment+grade+emp_length+
                  home_ownership+
                   annual_inc+issue_d+loan_status+purpose+addr_state+
                   inq_last_6mths+mths_since_last_delinq+
                   mths_since_last_record+open_acc+pub_rec+revol_bal+revol_util+
                   last_pymnt_d+last_pymnt_amnt+last_credit_pull_d
                 ,data=loan)
summary(testmodel3) # adjusted r2 of 88.25

```

### **Model Application**
Model application text

```{r predict for holdout case,echo = FALSE}
#apply model to test case
predict(testmodel3,test_case)
```

https://www.statmethods.net/stats/regression.html

### **Assumptions and Limitations**
Assumption/Limitation text


